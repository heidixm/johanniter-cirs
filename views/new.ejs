<% const isReadonly = typeof readonly !== 'undefined' ? readonly : false; %>
<% const p = preset || {}; %>
<% const pageTitle = isReadonly ? `Meldung #${p.id}` : 'Neue Meldung'; %>
<% layout('layout', { title: pageTitle }); %>

<div class="card">
  <h2><%= pageTitle %></h2>

  <% if (!isReadonly && showDisclaimer) { %>
    <p class="muted" style="margin-top:6px;">
      Bitte füllen Sie alle Pflichtfelder aus. Personenbezogene Daten nur im Einvernehmen erfassen.
    </p>
  <% } %>

  <% if (isReadonly) { %>
    <div class="grid" style="grid-template-columns:1fr 1fr;">
      <div>
        <div class="muted">#</div>
        <div><strong><%= p.id %></strong></div>
      </div>
      <div>
        <div class="muted">Erfasst am</div>
        <div><%= (p.created_at||'').replace('T',' ').replace('Z','') %></div>
      </div>
      <div>
        <div class="muted">Kategorie</div>
        <div><%= p.category %></div>
      </div>
      <div>
        <div class="muted">Ort</div>
        <div><%= p.location %></div>
      </div>
      <div style="grid-column:1/-1;">
        <div class="muted">Titel</div>
        <div><strong><%= p.title %></strong></div>
      </div>
      <div style="grid-column:1/-1;">
        <div class="muted">Zeitpunkt/Ereignis</div>
        <div><%= p.when_ts %></div>
      </div>
      <div style="grid-column:1/-1;">
        <div class="muted">Ressource/Asset</div>
        <div><%= p.asset || '—' %></div>
      </div>
      <div style="grid-column:1/-1;">
        <div class="muted">Beschreibung</div>
        <div style="white-space:pre-wrap"><%= p.description %></div>
      </div>
      <div style="grid-column:1/-1;">
        <div class="muted">Unmittelbare Maßnahmen</div>
        <div style="white-space:pre-wrap"><%= p.immediate || '—' %></div>
      </div>
      <div style="grid-column:1/-1;">
        <div class="muted">Kontakt</div>
        <div><%= (p.contact_name || '—') %> <%= p.contact_email ? '(' + p.contact_email + ')' : '' %></div>
      </div>
    </div>

    <div class="actions" style="margin-top:14px;">
      <a href="/" class="btn secondary">Zurück</a>
    </div>
  <% } else { %>
    <form action="/submit" method="post" style="margin-top:6px;">
      <div class="grid">
        <label>
          Kategorie*
          <input type="text" name="category" required />
        </label>
        <label>
          Zeitpunkt/Ereignis (ISO)*
          <input type="datetime-local" name="when" required />
        </label>
        <label>
          Ort*
          <input type="text" name="location" required />
        </label>
        <label>
          Titel*
          <input type="text" name="title" required />
        </label>
        <label>
          Ressource/Asset
          <input type="text" name="asset" placeholder="z.B. Gerät, Station, etc." />
        </label>
      </div>

      <label style="margin-top:6px;">
        Beschreibung*
        <textarea name="description" rows="6" required></textarea>
      </label>

      <label>
        Unmittelbare Maßnahmen
        <textarea name="immediate" rows="4"></textarea>
      </label>

      <div class="grid">
        <label>
          Kontaktname
          <input type="text" name="contactName" />
        </label>
        <label>
          Kontakt E-Mail
          <input type="email" name="contactEmail" />
        </label>
      </div>

      <div class="actions" style="margin-top: 10px;">
        <button type="submit" class="btn">Meldung senden</button>
        <a href="/" class="btn secondary">Abbrechen</a>
      </div>
    </form>
  <% } %>
</div>
